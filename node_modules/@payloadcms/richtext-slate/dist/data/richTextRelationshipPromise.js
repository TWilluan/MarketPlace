"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    recurseRichText: function() {
        return recurseRichText;
    },
    richTextRelationshipPromise: function() {
        return richTextRelationshipPromise;
    }
});
const _populate = require("./populate");
const _recurseNestedFields = require("./recurseNestedFields");
const recurseRichText = ({ children, currentDepth = 0, depth, draft, field, overrideAccess = false, promises, req, showHiddenFields })=>{
    if (depth <= 0 || currentDepth > depth) {
        return;
    }
    if (Array.isArray(children)) {
        children.forEach((element)=>{
            if ((element.type === 'relationship' || element.type === 'upload') && element?.value?.id) {
                const collection = req.payload.collections[element?.relationTo];
                if (collection) {
                    promises.push((0, _populate.populate)({
                        id: element.value.id,
                        collection,
                        currentDepth,
                        data: element,
                        depth,
                        draft,
                        field,
                        key: 'value',
                        overrideAccess,
                        req,
                        showHiddenFields
                    }));
                }
                if (element.type === 'upload' && Array.isArray(field.admin?.upload?.collections?.[element?.relationTo]?.fields)) {
                    (0, _recurseNestedFields.recurseNestedFields)({
                        currentDepth,
                        data: element.fields || {},
                        depth,
                        draft,
                        fields: field.admin.upload.collections[element.relationTo].fields,
                        overrideAccess,
                        promises,
                        req,
                        showHiddenFields
                    });
                }
            }
            if (element.type === 'link') {
                if (element?.doc?.value && element?.doc?.relationTo) {
                    const collection = req.payload.collections[element?.doc?.relationTo];
                    if (collection) {
                        promises.push((0, _populate.populate)({
                            id: element.doc.value,
                            collection,
                            currentDepth,
                            data: element.doc,
                            depth,
                            draft,
                            field,
                            key: 'value',
                            overrideAccess,
                            req,
                            showHiddenFields
                        }));
                    }
                }
                if (Array.isArray(field.admin?.link?.fields)) {
                    (0, _recurseNestedFields.recurseNestedFields)({
                        currentDepth,
                        data: element.fields || {},
                        depth,
                        draft,
                        fields: field.admin?.link?.fields,
                        overrideAccess,
                        promises,
                        req,
                        showHiddenFields
                    });
                }
            }
            if (element?.children) {
                recurseRichText({
                    children: element.children,
                    currentDepth,
                    depth,
                    draft,
                    field,
                    overrideAccess,
                    promises,
                    req,
                    showHiddenFields
                });
            }
        });
    }
};
const richTextRelationshipPromise = async ({ currentDepth, depth, draft, field, overrideAccess, req, showHiddenFields, siblingDoc })=>{
    const promises = [];
    recurseRichText({
        children: siblingDoc[field.name],
        currentDepth,
        depth,
        draft,
        field,
        overrideAccess,
        promises,
        req,
        showHiddenFields
    });
    await Promise.all(promises);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kYXRhL3JpY2hUZXh0UmVsYXRpb25zaGlwUHJvbWlzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0LCBSaWNoVGV4dEFkYXB0ZXIsIFJpY2hUZXh0RmllbGQgfSBmcm9tICdwYXlsb2FkL3R5cGVzJ1xuXG5pbXBvcnQgdHlwZSB7IEFkYXB0ZXJBcmd1bWVudHMgfSBmcm9tICcuLi90eXBlcydcblxuaW1wb3J0IHsgcG9wdWxhdGUgfSBmcm9tICcuL3BvcHVsYXRlJ1xuaW1wb3J0IHsgcmVjdXJzZU5lc3RlZEZpZWxkcyB9IGZyb20gJy4vcmVjdXJzZU5lc3RlZEZpZWxkcydcblxuZXhwb3J0IHR5cGUgQXJncyA9IFBhcmFtZXRlcnM8UmljaFRleHRBZGFwdGVyPGFueVtdLCBBZGFwdGVyQXJndW1lbnRzPlsncG9wdWxhdGlvblByb21pc2UnXT5bMF1cblxudHlwZSBSZWN1cnNlUmljaFRleHRBcmdzID0ge1xuICBjaGlsZHJlbjogdW5rbm93bltdXG4gIGN1cnJlbnREZXB0aDogbnVtYmVyXG4gIGRlcHRoOiBudW1iZXJcbiAgZHJhZnQ6IGJvb2xlYW5cbiAgZmllbGQ6IFJpY2hUZXh0RmllbGQ8YW55W10sIEFkYXB0ZXJBcmd1bWVudHMsIEFkYXB0ZXJBcmd1bWVudHM+XG4gIG92ZXJyaWRlQWNjZXNzOiBib29sZWFuXG4gIHByb21pc2VzOiBQcm9taXNlPHZvaWQ+W11cbiAgcmVxOiBQYXlsb2FkUmVxdWVzdFxuICBzaG93SGlkZGVuRmllbGRzOiBib29sZWFuXG59XG5cbmV4cG9ydCBjb25zdCByZWN1cnNlUmljaFRleHQgPSAoe1xuICBjaGlsZHJlbixcbiAgY3VycmVudERlcHRoID0gMCxcbiAgZGVwdGgsXG4gIGRyYWZ0LFxuICBmaWVsZCxcbiAgb3ZlcnJpZGVBY2Nlc3MgPSBmYWxzZSxcbiAgcHJvbWlzZXMsXG4gIHJlcSxcbiAgc2hvd0hpZGRlbkZpZWxkcyxcbn06IFJlY3Vyc2VSaWNoVGV4dEFyZ3MpOiB2b2lkID0+IHtcbiAgaWYgKGRlcHRoIDw9IDAgfHwgY3VycmVudERlcHRoID4gZGVwdGgpIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KGNoaWxkcmVuKSkge1xuICAgIDsoY2hpbGRyZW4gYXMgYW55W10pLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGlmICgoZWxlbWVudC50eXBlID09PSAncmVsYXRpb25zaGlwJyB8fCBlbGVtZW50LnR5cGUgPT09ICd1cGxvYWQnKSAmJiBlbGVtZW50Py52YWx1ZT8uaWQpIHtcbiAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHJlcS5wYXlsb2FkLmNvbGxlY3Rpb25zW2VsZW1lbnQ/LnJlbGF0aW9uVG9dXG5cbiAgICAgICAgaWYgKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICAgICAgcG9wdWxhdGUoe1xuICAgICAgICAgICAgICBpZDogZWxlbWVudC52YWx1ZS5pZCxcbiAgICAgICAgICAgICAgY29sbGVjdGlvbixcbiAgICAgICAgICAgICAgY3VycmVudERlcHRoLFxuICAgICAgICAgICAgICBkYXRhOiBlbGVtZW50LFxuICAgICAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICAgICAgZHJhZnQsXG4gICAgICAgICAgICAgIGZpZWxkLFxuICAgICAgICAgICAgICBrZXk6ICd2YWx1ZScsXG4gICAgICAgICAgICAgIG92ZXJyaWRlQWNjZXNzLFxuICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVsZW1lbnQudHlwZSA9PT0gJ3VwbG9hZCcgJiZcbiAgICAgICAgICBBcnJheS5pc0FycmF5KGZpZWxkLmFkbWluPy51cGxvYWQ/LmNvbGxlY3Rpb25zPy5bZWxlbWVudD8ucmVsYXRpb25Ub10/LmZpZWxkcylcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmVjdXJzZU5lc3RlZEZpZWxkcyh7XG4gICAgICAgICAgICBjdXJyZW50RGVwdGgsXG4gICAgICAgICAgICBkYXRhOiBlbGVtZW50LmZpZWxkcyB8fCB7fSxcbiAgICAgICAgICAgIGRlcHRoLFxuICAgICAgICAgICAgZHJhZnQsXG4gICAgICAgICAgICBmaWVsZHM6IGZpZWxkLmFkbWluLnVwbG9hZC5jb2xsZWN0aW9uc1tlbGVtZW50LnJlbGF0aW9uVG9dLmZpZWxkcyxcbiAgICAgICAgICAgIG92ZXJyaWRlQWNjZXNzLFxuICAgICAgICAgICAgcHJvbWlzZXMsXG4gICAgICAgICAgICByZXEsXG4gICAgICAgICAgICBzaG93SGlkZGVuRmllbGRzLFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gJ2xpbmsnKSB7XG4gICAgICAgIGlmIChlbGVtZW50Py5kb2M/LnZhbHVlICYmIGVsZW1lbnQ/LmRvYz8ucmVsYXRpb25Ubykge1xuICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSByZXEucGF5bG9hZC5jb2xsZWN0aW9uc1tlbGVtZW50Py5kb2M/LnJlbGF0aW9uVG9dXG5cbiAgICAgICAgICBpZiAoY29sbGVjdGlvbikge1xuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgICAgICAgcG9wdWxhdGUoe1xuICAgICAgICAgICAgICAgIGlkOiBlbGVtZW50LmRvYy52YWx1ZSxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgIGN1cnJlbnREZXB0aCxcbiAgICAgICAgICAgICAgICBkYXRhOiBlbGVtZW50LmRvYyxcbiAgICAgICAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICAgICAgICBkcmFmdCxcbiAgICAgICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICAgICAgICBrZXk6ICd2YWx1ZScsXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVBY2Nlc3MsXG4gICAgICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGZpZWxkLmFkbWluPy5saW5rPy5maWVsZHMpKSB7XG4gICAgICAgICAgcmVjdXJzZU5lc3RlZEZpZWxkcyh7XG4gICAgICAgICAgICBjdXJyZW50RGVwdGgsXG4gICAgICAgICAgICBkYXRhOiBlbGVtZW50LmZpZWxkcyB8fCB7fSxcbiAgICAgICAgICAgIGRlcHRoLFxuICAgICAgICAgICAgZHJhZnQsXG4gICAgICAgICAgICBmaWVsZHM6IGZpZWxkLmFkbWluPy5saW5rPy5maWVsZHMsXG4gICAgICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgICAgIHByb21pc2VzLFxuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChlbGVtZW50Py5jaGlsZHJlbikge1xuICAgICAgICByZWN1cnNlUmljaFRleHQoe1xuICAgICAgICAgIGNoaWxkcmVuOiBlbGVtZW50LmNoaWxkcmVuLFxuICAgICAgICAgIGN1cnJlbnREZXB0aCxcbiAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICBkcmFmdCxcbiAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgICBwcm9taXNlcyxcbiAgICAgICAgICByZXEsXG4gICAgICAgICAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCByaWNoVGV4dFJlbGF0aW9uc2hpcFByb21pc2UgPSBhc3luYyAoe1xuICBjdXJyZW50RGVwdGgsXG4gIGRlcHRoLFxuICBkcmFmdCxcbiAgZmllbGQsXG4gIG92ZXJyaWRlQWNjZXNzLFxuICByZXEsXG4gIHNob3dIaWRkZW5GaWVsZHMsXG4gIHNpYmxpbmdEb2MsXG59OiBBcmdzKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIGNvbnN0IHByb21pc2VzID0gW11cblxuICByZWN1cnNlUmljaFRleHQoe1xuICAgIGNoaWxkcmVuOiBzaWJsaW5nRG9jW2ZpZWxkLm5hbWVdIGFzIHVua25vd25bXSxcbiAgICBjdXJyZW50RGVwdGgsXG4gICAgZGVwdGgsXG4gICAgZHJhZnQsXG4gICAgZmllbGQsXG4gICAgb3ZlcnJpZGVBY2Nlc3MsXG4gICAgcHJvbWlzZXMsXG4gICAgcmVxLFxuICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gIH0pXG5cbiAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpXG59XG4iXSwibmFtZXMiOlsicmVjdXJzZVJpY2hUZXh0IiwicmljaFRleHRSZWxhdGlvbnNoaXBQcm9taXNlIiwiY2hpbGRyZW4iLCJjdXJyZW50RGVwdGgiLCJkZXB0aCIsImRyYWZ0IiwiZmllbGQiLCJvdmVycmlkZUFjY2VzcyIsInByb21pc2VzIiwicmVxIiwic2hvd0hpZGRlbkZpZWxkcyIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJlbGVtZW50IiwidHlwZSIsInZhbHVlIiwiaWQiLCJjb2xsZWN0aW9uIiwicGF5bG9hZCIsImNvbGxlY3Rpb25zIiwicmVsYXRpb25UbyIsInB1c2giLCJwb3B1bGF0ZSIsImRhdGEiLCJrZXkiLCJhZG1pbiIsInVwbG9hZCIsImZpZWxkcyIsInJlY3Vyc2VOZXN0ZWRGaWVsZHMiLCJkb2MiLCJsaW5rIiwic2libGluZ0RvYyIsIm5hbWUiLCJQcm9taXNlIiwiYWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQXFCYUEsZUFBZTtlQUFmQTs7SUE4R0FDLDJCQUEyQjtlQUEzQkE7OzswQkEvSFk7cUNBQ1c7QUFnQjdCLE1BQU1ELGtCQUFrQixDQUFDLEVBQzlCRSxR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