"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    transformExtraFields: function() {
        return transformExtraFields;
    },
    unwrapLink: function() {
        return unwrapLink;
    },
    withLinks: function() {
        return withLinks;
    },
    wrapLink: function() {
        return wrapLink;
    }
});
const _slate = require("slate");
const _baseFields = require("./LinkDrawer/baseFields");
const unwrapLink = (editor)=>{
    _slate.Transforms.unwrapNodes(editor, {
        match: (n)=>_slate.Element.isElement(n) && n.type === 'link'
    });
};
const wrapLink = (editor)=>{
    const { selection } = editor;
    const isCollapsed = selection && _slate.Range.isCollapsed(selection);
    const link = {
        children: isCollapsed ? [
            {
                text: ''
            }
        ] : [],
        newTab: false,
        type: 'link',
        url: undefined
    };
    if (isCollapsed) {
        _slate.Transforms.insertNodes(editor, link);
    } else {
        _slate.Transforms.wrapNodes(editor, link, {
            split: true
        });
        _slate.Transforms.collapse(editor, {
            edge: 'end'
        });
    }
};
const withLinks = (incomingEditor)=>{
    const editor = incomingEditor;
    const { isInline } = editor;
    editor.isInline = (element)=>{
        if (element.type === 'link') {
            return true;
        }
        return isInline(element);
    };
    return editor;
};
function transformExtraFields(customFieldSchema, config, i18n) {
    const baseFields = (0, _baseFields.getBaseFields)(config);
    const fields = typeof customFieldSchema === 'function' ? customFieldSchema({
        config,
        defaultFields: baseFields,
        i18n
    }) : baseFields;
    // Wrap fields which are not part of the base schema in a group named 'fields' - otherwise they will be rendered but not saved
    const extraFields = [];
    for(let i = fields.length - 1; i >= 0; i--){
        const field = fields[i];
        if ('name' in field) {
            if (!baseFields.find((baseField)=>!('name' in baseField) || baseField.name === field.name)) {
                if (field.name !== 'fields' && field.type !== 'group') {
                    extraFields.push(field);
                    // Remove from fields from now, as they need to be part of the fields group below
                    fields.splice(fields.indexOf(field), 1);
                }
            }
        }
    }
    if (Array.isArray(customFieldSchema) || fields.length > 0) {
        fields.push({
            name: 'fields',
            admin: {
                style: {
                    borderBottom: 0,
                    borderTop: 0,
                    margin: 0,
                    padding: 0
                }
            },
            fields: Array.isArray(customFieldSchema) ? customFieldSchema.concat(extraFields) : extraFields,
            type: 'group'
        });
    }
    return fields;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9maWVsZC9lbGVtZW50cy9saW5rL3V0aWxpdGllcy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBpMThuIH0gZnJvbSAnaTE4bmV4dCdcbmltcG9ydCB0eXBlIHsgU2FuaXRpemVkQ29uZmlnIH0gZnJvbSAncGF5bG9hZC9jb25maWcnXG5pbXBvcnQgdHlwZSB7IEZpZWxkIH0gZnJvbSAncGF5bG9hZC90eXBlcydcbmltcG9ydCB0eXBlIHsgRWRpdG9yIH0gZnJvbSAnc2xhdGUnXG5cbmltcG9ydCB7IEVsZW1lbnQsIFJhbmdlLCBUcmFuc2Zvcm1zIH0gZnJvbSAnc2xhdGUnXG5cbmltcG9ydCB7IGdldEJhc2VGaWVsZHMgfSBmcm9tICcuL0xpbmtEcmF3ZXIvYmFzZUZpZWxkcydcblxuZXhwb3J0IGNvbnN0IHVud3JhcExpbmsgPSAoZWRpdG9yOiBFZGl0b3IpOiB2b2lkID0+IHtcbiAgVHJhbnNmb3Jtcy51bndyYXBOb2RlcyhlZGl0b3IsIHsgbWF0Y2g6IChuKSA9PiBFbGVtZW50LmlzRWxlbWVudChuKSAmJiBuLnR5cGUgPT09ICdsaW5rJyB9KVxufVxuXG5leHBvcnQgY29uc3Qgd3JhcExpbmsgPSAoZWRpdG9yOiBFZGl0b3IpOiB2b2lkID0+IHtcbiAgY29uc3QgeyBzZWxlY3Rpb24gfSA9IGVkaXRvclxuICBjb25zdCBpc0NvbGxhcHNlZCA9IHNlbGVjdGlvbiAmJiBSYW5nZS5pc0NvbGxhcHNlZChzZWxlY3Rpb24pXG5cbiAgY29uc3QgbGluayA9IHtcbiAgICBjaGlsZHJlbjogaXNDb2xsYXBzZWQgPyBbeyB0ZXh0OiAnJyB9XSA6IFtdLFxuICAgIG5ld1RhYjogZmFsc2UsXG4gICAgdHlwZTogJ2xpbmsnLFxuICAgIHVybDogdW5kZWZpbmVkLFxuICB9XG5cbiAgaWYgKGlzQ29sbGFwc2VkKSB7XG4gICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGxpbmspXG4gIH0gZWxzZSB7XG4gICAgVHJhbnNmb3Jtcy53cmFwTm9kZXMoZWRpdG9yLCBsaW5rLCB7IHNwbGl0OiB0cnVlIH0pXG4gICAgVHJhbnNmb3Jtcy5jb2xsYXBzZShlZGl0b3IsIHsgZWRnZTogJ2VuZCcgfSlcbiAgfVxufVxuXG5leHBvcnQgY29uc3Qgd2l0aExpbmtzID0gKGluY29taW5nRWRpdG9yOiBFZGl0b3IpOiBFZGl0b3IgPT4ge1xuICBjb25zdCBlZGl0b3IgPSBpbmNvbWluZ0VkaXRvclxuICBjb25zdCB7IGlzSW5saW5lIH0gPSBlZGl0b3JcblxuICBlZGl0b3IuaXNJbmxpbmUgPSAoZWxlbWVudCkgPT4ge1xuICAgIGlmIChlbGVtZW50LnR5cGUgPT09ICdsaW5rJykge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICByZXR1cm4gaXNJbmxpbmUoZWxlbWVudClcbiAgfVxuXG4gIHJldHVybiBlZGl0b3Jcbn1cblxuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHJ1biB0byBlbnJpY2ggdGhlIGJhc2VmaWVsZHMgd2hpY2ggZXZlcnkgbGluayBoYXMgd2l0aCBwb3RlbnRpYWwsIGN1c3RvbSB1c2VyLWFkZGVkIGZpZWxkcy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybUV4dHJhRmllbGRzKFxuICBjdXN0b21GaWVsZFNjaGVtYTpcbiAgICB8ICgoYXJnczogeyBjb25maWc6IFNhbml0aXplZENvbmZpZzsgZGVmYXVsdEZpZWxkczogRmllbGRbXTsgaTE4bjogaTE4biB9KSA9PiBGaWVsZFtdKVxuICAgIHwgRmllbGRbXSxcbiAgY29uZmlnOiBTYW5pdGl6ZWRDb25maWcsXG4gIGkxOG46IGkxOG4sXG4pOiBGaWVsZFtdIHtcbiAgY29uc3QgYmFzZUZpZWxkczogRmllbGRbXSA9IGdldEJhc2VGaWVsZHMoY29uZmlnKVxuXG4gIGNvbnN0IGZpZWxkcyA9XG4gICAgdHlwZW9mIGN1c3RvbUZpZWxkU2NoZW1hID09PSAnZnVuY3Rpb24nXG4gICAgICA/IGN1c3RvbUZpZWxkU2NoZW1hKHsgY29uZmlnLCBkZWZhdWx0RmllbGRzOiBiYXNlRmllbGRzLCBpMThuIH0pXG4gICAgICA6IGJhc2VGaWVsZHNcblxuICAvLyBXcmFwIGZpZWxkcyB3aGljaCBhcmUgbm90IHBhcnQgb2YgdGhlIGJhc2Ugc2NoZW1hIGluIGEgZ3JvdXAgbmFtZWQgJ2ZpZWxkcycgLSBvdGhlcndpc2UgdGhleSB3aWxsIGJlIHJlbmRlcmVkIGJ1dCBub3Qgc2F2ZWRcbiAgY29uc3QgZXh0cmFGaWVsZHMgPSBbXVxuICBmb3IgKGxldCBpID0gZmllbGRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29uc3QgZmllbGQgPSBmaWVsZHNbaV1cblxuICAgIGlmICgnbmFtZScgaW4gZmllbGQpIHtcbiAgICAgIGlmIChcbiAgICAgICAgIWJhc2VGaWVsZHMuZmluZCgoYmFzZUZpZWxkKSA9PiAhKCduYW1lJyBpbiBiYXNlRmllbGQpIHx8IGJhc2VGaWVsZC5uYW1lID09PSBmaWVsZC5uYW1lKVxuICAgICAgKSB7XG4gICAgICAgIGlmIChmaWVsZC5uYW1lICE9PSAnZmllbGRzJyAmJiBmaWVsZC50eXBlICE9PSAnZ3JvdXAnKSB7XG4gICAgICAgICAgZXh0cmFGaWVsZHMucHVzaChmaWVsZClcbiAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBmaWVsZHMgZnJvbSBub3csIGFzIHRoZXkgbmVlZCB0byBiZSBwYXJ0IG9mIHRoZSBmaWVsZHMgZ3JvdXAgYmVsb3dcbiAgICAgICAgICBmaWVsZHMuc3BsaWNlKGZpZWxkcy5pbmRleE9mKGZpZWxkKSwgMSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KGN1c3RvbUZpZWxkU2NoZW1hKSB8fCBmaWVsZHMubGVuZ3RoID4gMCkge1xuICAgIGZpZWxkcy5wdXNoKHtcbiAgICAgIG5hbWU6ICdmaWVsZHMnLFxuICAgICAgYWRtaW46IHtcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICBib3JkZXJCb3R0b206IDAsXG4gICAgICAgICAgYm9yZGVyVG9wOiAwLFxuICAgICAgICAgIG1hcmdpbjogMCxcbiAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZpZWxkczogQXJyYXkuaXNBcnJheShjdXN0b21GaWVsZFNjaGVtYSlcbiAgICAgICAgPyBjdXN0b21GaWVsZFNjaGVtYS5jb25jYXQoZXh0cmFGaWVsZHMpXG4gICAgICAgIDogZXh0cmFGaWVsZHMsXG4gICAgICB0eXBlOiAnZ3JvdXAnLFxuICAgIH0pXG4gIH1cbiAgcmV0dXJuIGZpZWxkc1xufVxuIl0sIm5hbWVzIjpbInRyYW5zZm9ybUV4dHJhRmllbGRzIiwidW53cmFwTGluayIsIndpdGhMaW5rcyIsIndyYXBMaW5rIiwiZWRpdG9yIiwiVHJhbnNmb3JtcyIsInVud3JhcE5vZGVzIiwibWF0Y2giLCJuIiwiRWxlbWVudCIsImlzRWxlbWVudCIsInR5cGUiLCJzZWxlY3Rpb24iLCJpc0NvbGxhcHNlZCIsIlJhbmdlIiwibGluayIsImNoaWxkcmVuIiwidGV4dCIsIm5ld1RhYiIsInVybCIsInVuZGVmaW5lZCIsImluc2VydE5vZGVzIiwid3JhcE5vZGVzIiwic3BsaXQiLCJjb2xsYXBzZSIsImVkZ2UiLCJpbmNvbWluZ0VkaXRvciIsImlzSW5saW5lIiwiZWxlbWVudCIsImN1c3RvbUZpZWxkU2NoZW1hIiwiY29uZmlnIiwiaTE4biIsImJhc2VGaWVsZHMiLCJnZXRCYXNlRmllbGRzIiwiZmllbGRzIiwiZGVmYXVsdEZpZWxkcyIsImV4dHJhRmllbGRzIiwiaSIsImxlbmd0aCIsImZpZWxkIiwiZmluZCIsImJhc2VGaWVsZCIsIm5hbWUiLCJwdXNoIiwic3BsaWNlIiwiaW5kZXhPZiIsIkFycmF5IiwiaXNBcnJheSIsImFkbWluIiwic3R5bGUiLCJib3JkZXJCb3R0b20iLCJib3JkZXJUb3AiLCJtYXJnaW4iLCJwYWRkaW5nIiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQWtEZ0JBLG9CQUFvQjtl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