"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    Upload: function() {
        return Upload;
    },
    UploadActions: function() {
        return UploadActions;
    },
    editDrawerSlug: function() {
        return editDrawerSlug;
    },
    sizePreviewSlug: function() {
        return sizePreviewSlug;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _reacttoastify = require("react-toastify");
const _isImage = /*#__PURE__*/ _interop_require_default(require("../../../../../../uploads/isImage"));
const _Button = /*#__PURE__*/ _interop_require_default(require("../../../../elements/Button"));
const _Drawer = require("../../../../elements/Drawer");
const _Dropzone = require("../../../../elements/Dropzone");
const _EditUpload = require("../../../../elements/EditUpload");
const _FileDetails = /*#__PURE__*/ _interop_require_default(require("../../../../elements/FileDetails"));
const _PreviewSizes = /*#__PURE__*/ _interop_require_default(require("../../../../elements/PreviewSizes"));
const _Thumbnail = /*#__PURE__*/ _interop_require_default(require("../../../../elements/Thumbnail"));
const _Error = /*#__PURE__*/ _interop_require_default(require("../../../../forms/Error"));
const _context = require("../../../../forms/Form/context");
const _reduceFieldsToValues = /*#__PURE__*/ _interop_require_default(require("../../../../forms/Form/reduceFieldsToValues"));
const _shared = require("../../../../forms/field-types/shared");
const _useField = /*#__PURE__*/ _interop_require_default(require("../../../../forms/useField"));
const _DocumentInfo = require("../../../../utilities/DocumentInfo");
const _UploadEdits = require("../../../../utilities/UploadEdits");
require("./index.scss");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'file-field';
const editDrawerSlug = 'edit-upload';
const sizePreviewSlug = 'preview-sizes';
const validate = (value)=>{
    if (!value && value !== undefined) {
        return 'A file is required.';
    }
    return true;
};
const UploadActions = ({ canEdit, showSizePreviews })=>{
    const { t } = (0, _reacti18next.useTranslation)('upload');
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__file-mutation`
    }, showSizePreviews && /*#__PURE__*/ _react.default.createElement(_Drawer.DrawerToggler, {
        className: `${baseClass}__previewSizes`,
        slug: sizePreviewSlug
    }, t('upload:previewSizes')), canEdit && /*#__PURE__*/ _react.default.createElement(_Drawer.DrawerToggler, {
        className: `${baseClass}__edit`,
        slug: editDrawerSlug
    }, t('upload:editImage')));
};
const Upload = (props)=>{
    const { collection, internalState, onChange } = props;
    const [replacingFile, setReplacingFile] = (0, _react.useState)(false);
    const [fileSrc, setFileSrc] = (0, _react.useState)(null);
    const { t } = (0, _reacti18next.useTranslation)([
        'upload',
        'general'
    ]);
    const { setModified } = (0, _context.useForm)();
    const { resetUploadEdits, updateUploadEdits, uploadEdits } = (0, _UploadEdits.useUploadEdits)();
    const [doc, setDoc] = (0, _react.useState)((0, _reduceFieldsToValues.default)(internalState || {}, true));
    const { docPermissions } = (0, _DocumentInfo.useDocumentInfo)();
    const { errorMessage, setValue, showError, value } = (0, _useField.default)({
        path: 'file',
        validate
    });
    const [showUrlInput, setShowUrlInput] = (0, _react.useState)(false);
    const [fileUrl, setFileUrl] = (0, _react.useState)('');
    const cursorPositionRef = (0, _react.useRef)(null);
    const urlInputRef = (0, _react.useRef)(null);
    const handleFileChange = (0, _react.useCallback)((newFile)=>{
        if (newFile instanceof File) {
            const fileReader = new FileReader();
            fileReader.onload = (e)=>{
                const imgSrc = e.target?.result;
                if (typeof imgSrc === 'string') {
                    setFileSrc(imgSrc);
                }
            };
            fileReader.readAsDataURL(newFile);
        }
        setValue(newFile);
        setShowUrlInput(false);
        if (typeof onChange === 'function') {
            onChange(newFile);
        }
    }, [
        onChange,
        setValue
    ]);
    const handleFileNameChange = (e)=>{
        const updatedFileName = e.target.value;
        const cursorPosition = e.target.selectionStart;
        cursorPositionRef.current = cursorPosition;
        if (value) {
            const fileValue = value;
            // Creating a new File object with updated properties
            const newFile = new File([
                fileValue
            ], updatedFileName, {
                type: fileValue.type
            });
            handleFileChange(newFile);
        }
    };
    (0, _react.useEffect)(()=>{
        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion
        const inputElement = document.querySelector(`.${baseClass}__filename`);
        if (inputElement && cursorPositionRef.current !== null) {
            inputElement.setSelectionRange(cursorPositionRef.current, cursorPositionRef.current);
        }
    }, [
        value
    ]);
    const handleFileSelection = _react.default.useCallback((files)=>{
        const fileToUpload = files?.[0];
        handleFileChange(fileToUpload);
    }, [
        handleFileChange
    ]);
    const handleFileRemoval = (0, _react.useCallback)(()=>{
        setReplacingFile(true);
        handleFileChange(null);
        setFileSrc('');
        setFileUrl('');
        setDoc({});
        resetUploadEdits();
        setShowUrlInput(false);
    }, [
        handleFileChange,
        resetUploadEdits
    ]);
    const onEditsSave = (0, _react.useCallback)((args)=>{
        setModified(true);
        updateUploadEdits(args);
    }, [
        setModified,
        updateUploadEdits
    ]);
    const handlePasteUrlClick = ()=>{
        setShowUrlInput((prev)=>!prev);
    };
    const handleUrlSubmit = async ()=>{
        if (fileUrl) {
            try {
                const response = await fetch(fileUrl);
                const data = await response.blob();
                // Extract the file name from the URL
                const fileName = fileUrl.split('/').pop();
                // Create a new File object from the Blob data
                const file = new File([
                    data
                ], fileName, {
                    type: data.type
                });
                handleFileChange(file);
            } catch (e) {
                _reacttoastify.toast.error(e.message);
            }
        }
    };
    (0, _react.useEffect)(()=>{
        setDoc((0, _reduceFieldsToValues.default)(internalState || {}, true));
        setReplacingFile(false);
    }, [
        internalState
    ]);
    (0, _react.useEffect)(()=>{
        if (showUrlInput && urlInputRef.current) {
            urlInputRef.current.focus() // Focus on the remote-url input field when showUrlInput is true
            ;
        }
    }, [
        showUrlInput
    ]);
    const canRemoveUpload = docPermissions?.update?.permission && 'delete' in docPermissions && docPermissions?.delete?.permission;
    const hasImageSizes = collection?.upload?.imageSizes?.length > 0;
    const hasResizeOptions = Boolean(collection?.upload?.resizeOptions);
    // Explicitly check if set to true, default is undefined
    const focalPointEnabled = collection?.upload?.focalPoint === true;
    const { collection: { upload: { crop: showCrop = true, focalPoint = true } } = {} } = props;
    const showFocalPoint = focalPoint && (hasImageSizes || hasResizeOptions || focalPointEnabled);
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            _shared.fieldBaseClass,
            baseClass
        ].filter(Boolean).join(' ')
    }, /*#__PURE__*/ _react.default.createElement(_Error.default, {
        message: errorMessage,
        showError: showError
    }), doc.filename && !replacingFile && /*#__PURE__*/ _react.default.createElement(_FileDetails.default, {
        canEdit: showCrop || showFocalPoint,
        collection: collection,
        doc: doc,
        handleRemove: canRemoveUpload ? handleFileRemoval : undefined,
        hasImageSizes: hasImageSizes,
        imageCacheTag: doc.updatedAt
    }), (!doc.filename || replacingFile) && /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__upload`
    }, !value && !showUrlInput && /*#__PURE__*/ _react.default.createElement(_Dropzone.Dropzone, {
        className: `${baseClass}__dropzone`,
        mimeTypes: collection?.upload?.mimeTypes,
        onChange: handleFileSelection,
        onPasteUrlClick: handlePasteUrlClick
    }), showUrlInput && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__remote-file-wrap`
    }, /*#__PURE__*/ _react.default.createElement("input", {
        className: `${baseClass}__remote-file`,
        onChange: (e)=>{
            setFileUrl(e.target.value);
        },
        ref: urlInputRef,
        type: "text",
        value: fileUrl
    }), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__add-file-wrap`
    }, /*#__PURE__*/ _react.default.createElement("button", {
        className: `${baseClass}__add-file`,
        onClick: handleUrlSubmit,
        type: "button"
    }, t('upload:addFile')))), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__remove`,
        icon: "x",
        iconStyle: "with-border",
        onClick: handleFileRemoval,
        round: true,
        tooltip: t('general:cancel')
    })), value && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__thumbnail-wrap`
    }, /*#__PURE__*/ _react.default.createElement(_Thumbnail.default, {
        fileSrc: (0, _isImage.default)(value.type) ? fileSrc : null
    })), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__file-adjustments`
    }, /*#__PURE__*/ _react.default.createElement("input", {
        className: `${baseClass}__filename`,
        onChange: handleFileNameChange,
        type: "text",
        value: value.name
    }), (0, _isImage.default)(value.type) && value.type !== 'image/svg+xml' && /*#__PURE__*/ _react.default.createElement(UploadActions, {
        canEdit: showCrop || showFocalPoint,
        showSizePreviews: hasImageSizes && doc.filename && !replacingFile
    })), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__remove`,
        icon: "x",
        iconStyle: "with-border",
        onClick: handleFileRemoval,
        round: true,
        tooltip: t('general:cancel')
    }))), (value || doc.filename) && /*#__PURE__*/ _react.default.createElement(_Drawer.Drawer, {
        header: null,
        slug: editDrawerSlug
    }, /*#__PURE__*/ _react.default.createElement(_EditUpload.EditUpload, {
        fileName: value?.name || doc?.filename,
        fileSrc: doc?.url || fileSrc,
        imageCacheTag: doc.updatedAt,
        initialCrop: uploadEdits?.crop ?? undefined,
        initialFocalPoint: {
            x: uploadEdits?.focalPoint?.x || doc.focalX || 50,
            y: uploadEdits?.focalPoint?.y || doc.focalY || 50
        },
        onSave: onEditsSave,
        showCrop: showCrop,
        showFocalPoint: showFocalPoint
    })), doc && hasImageSizes && /*#__PURE__*/ _react.default.createElement(_Drawer.Drawer, {
        className: `${baseClass}__previewDrawer`,
        hoverTitle: true,
        slug: sizePreviewSlug,
        title: t('upload:sizesFor', {
            label: doc?.filename
        })
    }, /*#__PURE__*/ _react.default.createElement(_PreviewSizes.default, {
        collection: collection,
        doc: doc,
        imageCacheTag: doc.updatedAt
    })));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL3ZpZXdzL2NvbGxlY3Rpb25zL0VkaXQvVXBsb2FkL2luZGV4LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0J1xuaW1wb3J0IHsgdG9hc3QgfSBmcm9tICdyZWFjdC10b2FzdGlmeSdcblxuaW1wb3J0IHR5cGUgeyBVcGxvYWRFZGl0cyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uL3VwbG9hZHMvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFByb3BzIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IGlzSW1hZ2UgZnJvbSAnLi4vLi4vLi4vLi4vLi4vLi4vdXBsb2Fkcy9pc0ltYWdlJ1xuaW1wb3J0IEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9lbGVtZW50cy9CdXR0b24nXG5pbXBvcnQgeyBEcmF3ZXIsIERyYXdlclRvZ2dsZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9lbGVtZW50cy9EcmF3ZXInXG5pbXBvcnQgeyBEcm9wem9uZSB9IGZyb20gJy4uLy4uLy4uLy4uL2VsZW1lbnRzL0Ryb3B6b25lJ1xuaW1wb3J0IHsgRWRpdFVwbG9hZCB9IGZyb20gJy4uLy4uLy4uLy4uL2VsZW1lbnRzL0VkaXRVcGxvYWQnXG5pbXBvcnQgRmlsZURldGFpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZWxlbWVudHMvRmlsZURldGFpbHMnXG5pbXBvcnQgUHJldmlld1NpemVzIGZyb20gJy4uLy4uLy4uLy4uL2VsZW1lbnRzL1ByZXZpZXdTaXplcydcbmltcG9ydCBUaHVtYm5haWwgZnJvbSAnLi4vLi4vLi4vLi4vZWxlbWVudHMvVGh1bWJuYWlsJ1xuaW1wb3J0IEVycm9yIGZyb20gJy4uLy4uLy4uLy4uL2Zvcm1zL0Vycm9yJ1xuaW1wb3J0IHsgdXNlRm9ybSB9IGZyb20gJy4uLy4uLy4uLy4uL2Zvcm1zL0Zvcm0vY29udGV4dCdcbmltcG9ydCByZWR1Y2VGaWVsZHNUb1ZhbHVlcyBmcm9tICcuLi8uLi8uLi8uLi9mb3Jtcy9Gb3JtL3JlZHVjZUZpZWxkc1RvVmFsdWVzJ1xuaW1wb3J0IHsgZmllbGRCYXNlQ2xhc3MgfSBmcm9tICcuLi8uLi8uLi8uLi9mb3Jtcy9maWVsZC10eXBlcy9zaGFyZWQnXG5pbXBvcnQgdXNlRmllbGQgZnJvbSAnLi4vLi4vLi4vLi4vZm9ybXMvdXNlRmllbGQnXG5pbXBvcnQgeyB1c2VEb2N1bWVudEluZm8gfSBmcm9tICcuLi8uLi8uLi8uLi91dGlsaXRpZXMvRG9jdW1lbnRJbmZvJ1xuaW1wb3J0IHsgdXNlVXBsb2FkRWRpdHMgfSBmcm9tICcuLi8uLi8uLi8uLi91dGlsaXRpZXMvVXBsb2FkRWRpdHMnXG5pbXBvcnQgJy4vaW5kZXguc2NzcydcblxuY29uc3QgYmFzZUNsYXNzID0gJ2ZpbGUtZmllbGQnXG5leHBvcnQgY29uc3QgZWRpdERyYXdlclNsdWcgPSAnZWRpdC11cGxvYWQnXG5leHBvcnQgY29uc3Qgc2l6ZVByZXZpZXdTbHVnID0gJ3ByZXZpZXctc2l6ZXMnXG5cbmNvbnN0IHZhbGlkYXRlID0gKHZhbHVlKSA9PiB7XG4gIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiAnQSBmaWxlIGlzIHJlcXVpcmVkLidcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbmV4cG9ydCBjb25zdCBVcGxvYWRBY3Rpb25zID0gKHsgY2FuRWRpdCwgc2hvd1NpemVQcmV2aWV3cyB9KSA9PiB7XG4gIGNvbnN0IHsgdCB9ID0gdXNlVHJhbnNsYXRpb24oJ3VwbG9hZCcpXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2ZpbGUtbXV0YXRpb25gfT5cbiAgICAgIHtzaG93U2l6ZVByZXZpZXdzICYmIChcbiAgICAgICAgPERyYXdlclRvZ2dsZXIgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19wcmV2aWV3U2l6ZXNgfSBzbHVnPXtzaXplUHJldmlld1NsdWd9PlxuICAgICAgICAgIHt0KCd1cGxvYWQ6cHJldmlld1NpemVzJyl9XG4gICAgICAgIDwvRHJhd2VyVG9nZ2xlcj5cbiAgICAgICl9XG4gICAgICB7Y2FuRWRpdCAmJiAoXG4gICAgICAgIDxEcmF3ZXJUb2dnbGVyIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fZWRpdGB9IHNsdWc9e2VkaXREcmF3ZXJTbHVnfT5cbiAgICAgICAgICB7dCgndXBsb2FkOmVkaXRJbWFnZScpfVxuICAgICAgICA8L0RyYXdlclRvZ2dsZXI+XG4gICAgICApfVxuICAgIDwvZGl2PlxuICApXG59XG5cbmV4cG9ydCBjb25zdCBVcGxvYWQ6IFJlYWN0LkZDPFByb3BzPiA9IChwcm9wcykgPT4ge1xuICBjb25zdCB7IGNvbGxlY3Rpb24sIGludGVybmFsU3RhdGUsIG9uQ2hhbmdlIH0gPSBwcm9wc1xuICBjb25zdCBbcmVwbGFjaW5nRmlsZSwgc2V0UmVwbGFjaW5nRmlsZV0gPSB1c2VTdGF0ZShmYWxzZSlcbiAgY29uc3QgW2ZpbGVTcmMsIHNldEZpbGVTcmNdID0gdXNlU3RhdGU8bnVsbCB8IHN0cmluZz4obnVsbClcbiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbihbJ3VwbG9hZCcsICdnZW5lcmFsJ10pXG4gIGNvbnN0IHsgc2V0TW9kaWZpZWQgfSA9IHVzZUZvcm0oKVxuICBjb25zdCB7IHJlc2V0VXBsb2FkRWRpdHMsIHVwZGF0ZVVwbG9hZEVkaXRzLCB1cGxvYWRFZGl0cyB9ID0gdXNlVXBsb2FkRWRpdHMoKVxuICBjb25zdCBbZG9jLCBzZXREb2NdID0gdXNlU3RhdGUocmVkdWNlRmllbGRzVG9WYWx1ZXMoaW50ZXJuYWxTdGF0ZSB8fCB7fSwgdHJ1ZSkpXG4gIGNvbnN0IHsgZG9jUGVybWlzc2lvbnMgfSA9IHVzZURvY3VtZW50SW5mbygpXG4gIGNvbnN0IHsgZXJyb3JNZXNzYWdlLCBzZXRWYWx1ZSwgc2hvd0Vycm9yLCB2YWx1ZSB9ID0gdXNlRmllbGQ8RmlsZT4oe1xuICAgIHBhdGg6ICdmaWxlJyxcbiAgICB2YWxpZGF0ZSxcbiAgfSlcblxuICBjb25zdCBbc2hvd1VybElucHV0LCBzZXRTaG93VXJsSW5wdXRdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFtmaWxlVXJsLCBzZXRGaWxlVXJsXSA9IHVzZVN0YXRlPHN0cmluZz4oJycpXG5cbiAgY29uc3QgY3Vyc29yUG9zaXRpb25SZWYgPSB1c2VSZWYobnVsbClcbiAgY29uc3QgdXJsSW5wdXRSZWYgPSB1c2VSZWY8SFRNTElucHV0RWxlbWVudD4obnVsbClcblxuICBjb25zdCBoYW5kbGVGaWxlQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgKG5ld0ZpbGU6IEZpbGUpID0+IHtcbiAgICAgIGlmIChuZXdGaWxlIGluc3RhbmNlb2YgRmlsZSkge1xuICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgaW1nU3JjID0gZS50YXJnZXQ/LnJlc3VsdFxuXG4gICAgICAgICAgaWYgKHR5cGVvZiBpbWdTcmMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzZXRGaWxlU3JjKGltZ1NyYylcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNEYXRhVVJMKG5ld0ZpbGUpXG4gICAgICB9XG5cbiAgICAgIHNldFZhbHVlKG5ld0ZpbGUpXG4gICAgICBzZXRTaG93VXJsSW5wdXQoZmFsc2UpXG5cbiAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgb25DaGFuZ2UobmV3RmlsZSlcbiAgICAgIH1cbiAgICB9LFxuICAgIFtvbkNoYW5nZSwgc2V0VmFsdWVdLFxuICApXG5cbiAgY29uc3QgaGFuZGxlRmlsZU5hbWVDaGFuZ2UgPSAoZTogUmVhY3QuQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCB1cGRhdGVkRmlsZU5hbWUgPSBlLnRhcmdldC52YWx1ZVxuICAgIGNvbnN0IGN1cnNvclBvc2l0aW9uID0gZS50YXJnZXQuc2VsZWN0aW9uU3RhcnRcblxuICAgIGN1cnNvclBvc2l0aW9uUmVmLmN1cnJlbnQgPSBjdXJzb3JQb3NpdGlvblxuXG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICBjb25zdCBmaWxlVmFsdWUgPSB2YWx1ZVxuICAgICAgLy8gQ3JlYXRpbmcgYSBuZXcgRmlsZSBvYmplY3Qgd2l0aCB1cGRhdGVkIHByb3BlcnRpZXNcbiAgICAgIGNvbnN0IG5ld0ZpbGUgPSBuZXcgRmlsZShbZmlsZVZhbHVlXSwgdXBkYXRlZEZpbGVOYW1lLCB7IHR5cGU6IGZpbGVWYWx1ZS50eXBlIH0pXG4gICAgICBoYW5kbGVGaWxlQ2hhbmdlKG5ld0ZpbGUpXG4gICAgfVxuICB9XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVubmVjZXNzYXJ5LXR5cGUtYXNzZXJ0aW9uXG4gICAgY29uc3QgaW5wdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7YmFzZUNsYXNzfV9fZmlsZW5hbWVgKSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgaWYgKGlucHV0RWxlbWVudCAmJiBjdXJzb3JQb3NpdGlvblJlZi5jdXJyZW50ICE9PSBudWxsKSB7XG4gICAgICBpbnB1dEVsZW1lbnQuc2V0U2VsZWN0aW9uUmFuZ2UoY3Vyc29yUG9zaXRpb25SZWYuY3VycmVudCwgY3Vyc29yUG9zaXRpb25SZWYuY3VycmVudClcbiAgICB9XG4gIH0sIFt2YWx1ZV0pXG5cbiAgY29uc3QgaGFuZGxlRmlsZVNlbGVjdGlvbiA9IFJlYWN0LnVzZUNhbGxiYWNrKFxuICAgIChmaWxlczogRmlsZUxpc3QpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVUb1VwbG9hZCA9IGZpbGVzPy5bMF1cbiAgICAgIGhhbmRsZUZpbGVDaGFuZ2UoZmlsZVRvVXBsb2FkKVxuICAgIH0sXG4gICAgW2hhbmRsZUZpbGVDaGFuZ2VdLFxuICApXG5cbiAgY29uc3QgaGFuZGxlRmlsZVJlbW92YWwgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0UmVwbGFjaW5nRmlsZSh0cnVlKVxuICAgIGhhbmRsZUZpbGVDaGFuZ2UobnVsbClcbiAgICBzZXRGaWxlU3JjKCcnKVxuICAgIHNldEZpbGVVcmwoJycpXG4gICAgc2V0RG9jKHt9KVxuICAgIHJlc2V0VXBsb2FkRWRpdHMoKVxuICAgIHNldFNob3dVcmxJbnB1dChmYWxzZSlcbiAgfSwgW2hhbmRsZUZpbGVDaGFuZ2UsIHJlc2V0VXBsb2FkRWRpdHNdKVxuXG4gIGNvbnN0IG9uRWRpdHNTYXZlID0gdXNlQ2FsbGJhY2soXG4gICAgKGFyZ3M6IFVwbG9hZEVkaXRzKSA9PiB7XG4gICAgICBzZXRNb2RpZmllZCh0cnVlKVxuICAgICAgdXBkYXRlVXBsb2FkRWRpdHMoYXJncylcbiAgICB9LFxuICAgIFtzZXRNb2RpZmllZCwgdXBkYXRlVXBsb2FkRWRpdHNdLFxuICApXG5cbiAgY29uc3QgaGFuZGxlUGFzdGVVcmxDbGljayA9ICgpID0+IHtcbiAgICBzZXRTaG93VXJsSW5wdXQoKHByZXYpID0+ICFwcmV2KVxuICB9XG5cbiAgY29uc3QgaGFuZGxlVXJsU3VibWl0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmIChmaWxlVXJsKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGVVcmwpXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5ibG9iKClcblxuICAgICAgICAvLyBFeHRyYWN0IHRoZSBmaWxlIG5hbWUgZnJvbSB0aGUgVVJMXG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gZmlsZVVybC5zcGxpdCgnLycpLnBvcCgpXG5cbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IEZpbGUgb2JqZWN0IGZyb20gdGhlIEJsb2IgZGF0YVxuICAgICAgICBjb25zdCBmaWxlID0gbmV3IEZpbGUoW2RhdGFdLCBmaWxlTmFtZSwgeyB0eXBlOiBkYXRhLnR5cGUgfSlcbiAgICAgICAgaGFuZGxlRmlsZUNoYW5nZShmaWxlKVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0b2FzdC5lcnJvcihlLm1lc3NhZ2UpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBzZXREb2MocmVkdWNlRmllbGRzVG9WYWx1ZXMoaW50ZXJuYWxTdGF0ZSB8fCB7fSwgdHJ1ZSkpXG4gICAgc2V0UmVwbGFjaW5nRmlsZShmYWxzZSlcbiAgfSwgW2ludGVybmFsU3RhdGVdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHNob3dVcmxJbnB1dCAmJiB1cmxJbnB1dFJlZi5jdXJyZW50KSB7XG4gICAgICB1cmxJbnB1dFJlZi5jdXJyZW50LmZvY3VzKCkgLy8gRm9jdXMgb24gdGhlIHJlbW90ZS11cmwgaW5wdXQgZmllbGQgd2hlbiBzaG93VXJsSW5wdXQgaXMgdHJ1ZVxuICAgIH1cbiAgfSwgW3Nob3dVcmxJbnB1dF0pXG5cbiAgY29uc3QgY2FuUmVtb3ZlVXBsb2FkID1cbiAgICBkb2NQZXJtaXNzaW9ucz8udXBkYXRlPy5wZXJtaXNzaW9uICYmXG4gICAgJ2RlbGV0ZScgaW4gZG9jUGVybWlzc2lvbnMgJiZcbiAgICBkb2NQZXJtaXNzaW9ucz8uZGVsZXRlPy5wZXJtaXNzaW9uXG5cbiAgY29uc3QgaGFzSW1hZ2VTaXplcyA9IGNvbGxlY3Rpb24/LnVwbG9hZD8uaW1hZ2VTaXplcz8ubGVuZ3RoID4gMFxuICBjb25zdCBoYXNSZXNpemVPcHRpb25zID0gQm9vbGVhbihjb2xsZWN0aW9uPy51cGxvYWQ/LnJlc2l6ZU9wdGlvbnMpXG4gIC8vIEV4cGxpY2l0bHkgY2hlY2sgaWYgc2V0IHRvIHRydWUsIGRlZmF1bHQgaXMgdW5kZWZpbmVkXG4gIGNvbnN0IGZvY2FsUG9pbnRFbmFibGVkID0gY29sbGVjdGlvbj8udXBsb2FkPy5mb2NhbFBvaW50ID09PSB0cnVlXG5cbiAgY29uc3QgeyBjb2xsZWN0aW9uOiB7IHVwbG9hZDogeyBjcm9wOiBzaG93Q3JvcCA9IHRydWUsIGZvY2FsUG9pbnQgPSB0cnVlIH0gfSA9IHt9IH0gPSBwcm9wc1xuXG4gIGNvbnN0IHNob3dGb2NhbFBvaW50ID0gZm9jYWxQb2ludCAmJiAoaGFzSW1hZ2VTaXplcyB8fCBoYXNSZXNpemVPcHRpb25zIHx8IGZvY2FsUG9pbnRFbmFibGVkKVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e1tmaWVsZEJhc2VDbGFzcywgYmFzZUNsYXNzXS5maWx0ZXIoQm9vbGVhbikuam9pbignICcpfT5cbiAgICAgIDxFcnJvciBtZXNzYWdlPXtlcnJvck1lc3NhZ2V9IHNob3dFcnJvcj17c2hvd0Vycm9yfSAvPlxuXG4gICAgICB7ZG9jLmZpbGVuYW1lICYmICFyZXBsYWNpbmdGaWxlICYmIChcbiAgICAgICAgPEZpbGVEZXRhaWxzXG4gICAgICAgICAgY2FuRWRpdD17c2hvd0Nyb3AgfHwgc2hvd0ZvY2FsUG9pbnR9XG4gICAgICAgICAgY29sbGVjdGlvbj17Y29sbGVjdGlvbn1cbiAgICAgICAgICBkb2M9e2RvY31cbiAgICAgICAgICBoYW5kbGVSZW1vdmU9e2NhblJlbW92ZVVwbG9hZCA/IGhhbmRsZUZpbGVSZW1vdmFsIDogdW5kZWZpbmVkfVxuICAgICAgICAgIGhhc0ltYWdlU2l6ZXM9e2hhc0ltYWdlU2l6ZXN9XG4gICAgICAgICAgaW1hZ2VDYWNoZVRhZz17ZG9jLnVwZGF0ZWRBdH1cbiAgICAgICAgLz5cbiAgICAgICl9XG4gICAgICB7KCFkb2MuZmlsZW5hbWUgfHwgcmVwbGFjaW5nRmlsZSkgJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fdXBsb2FkYH0+XG4gICAgICAgICAgeyF2YWx1ZSAmJiAhc2hvd1VybElucHV0ICYmIChcbiAgICAgICAgICAgIDxEcm9wem9uZVxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2Ryb3B6b25lYH1cbiAgICAgICAgICAgICAgbWltZVR5cGVzPXtjb2xsZWN0aW9uPy51cGxvYWQ/Lm1pbWVUeXBlc31cbiAgICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUZpbGVTZWxlY3Rpb259XG4gICAgICAgICAgICAgIG9uUGFzdGVVcmxDbGljaz17aGFuZGxlUGFzdGVVcmxDbGlja31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7c2hvd1VybElucHV0ICYmIChcbiAgICAgICAgICAgIDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3JlbW90ZS1maWxlLXdyYXBgfT5cbiAgICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fcmVtb3RlLWZpbGVgfVxuICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldEZpbGVVcmwoZS50YXJnZXQudmFsdWUpXG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgcmVmPXt1cmxJbnB1dFJlZn1cbiAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICAgIHZhbHVlPXtmaWxlVXJsfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2FkZC1maWxlLXdyYXBgfT5cbiAgICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19hZGQtZmlsZWB9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVVybFN1Ym1pdH1cbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHt0KCd1cGxvYWQ6YWRkRmlsZScpfVxuICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJpY29uLWxhYmVsXCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3JlbW92ZWB9XG4gICAgICAgICAgICAgICAgaWNvbj1cInhcIlxuICAgICAgICAgICAgICAgIGljb25TdHlsZT1cIndpdGgtYm9yZGVyXCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVGaWxlUmVtb3ZhbH1cbiAgICAgICAgICAgICAgICByb3VuZFxuICAgICAgICAgICAgICAgIHRvb2x0aXA9e3QoJ2dlbmVyYWw6Y2FuY2VsJyl9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICl9XG4gICAgICAgICAge3ZhbHVlICYmIChcbiAgICAgICAgICAgIDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3RodW1ibmFpbC13cmFwYH0+XG4gICAgICAgICAgICAgICAgPFRodW1ibmFpbCBmaWxlU3JjPXtpc0ltYWdlKHZhbHVlLnR5cGUpID8gZmlsZVNyYyA6IG51bGx9IC8+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fZmlsZS1hZGp1c3RtZW50c2B9PlxuICAgICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19maWxlbmFtZWB9XG4gICAgICAgICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlRmlsZU5hbWVDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUubmFtZX1cbiAgICAgICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICAgICAge2lzSW1hZ2UodmFsdWUudHlwZSkgJiYgdmFsdWUudHlwZSAhPT0gJ2ltYWdlL3N2Zyt4bWwnICYmIChcbiAgICAgICAgICAgICAgICAgIDxVcGxvYWRBY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgIGNhbkVkaXQ9e3Nob3dDcm9wIHx8IHNob3dGb2NhbFBvaW50fVxuICAgICAgICAgICAgICAgICAgICBzaG93U2l6ZVByZXZpZXdzPXtoYXNJbWFnZVNpemVzICYmIGRvYy5maWxlbmFtZSAmJiAhcmVwbGFjaW5nRmlsZX1cbiAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cImljb24tbGFiZWxcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fcmVtb3ZlYH1cbiAgICAgICAgICAgICAgICBpY29uPVwieFwiXG4gICAgICAgICAgICAgICAgaWNvblN0eWxlPVwid2l0aC1ib3JkZXJcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUZpbGVSZW1vdmFsfVxuICAgICAgICAgICAgICAgIHJvdW5kXG4gICAgICAgICAgICAgICAgdG9vbHRpcD17dCgnZ2VuZXJhbDpjYW5jZWwnKX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuXG4gICAgICB7KHZhbHVlIHx8IGRvYy5maWxlbmFtZSkgJiYgKFxuICAgICAgICA8RHJhd2VyIGhlYWRlcj17bnVsbH0gc2x1Zz17ZWRpdERyYXdlclNsdWd9PlxuICAgICAgICAgIDxFZGl0VXBsb2FkXG4gICAgICAgICAgICBmaWxlTmFtZT17dmFsdWU/Lm5hbWUgfHwgZG9jPy5maWxlbmFtZX1cbiAgICAgICAgICAgIGZpbGVTcmM9e2RvYz8udXJsIHx8IGZpbGVTcmN9XG4gICAgICAgICAgICBpbWFnZUNhY2hlVGFnPXtkb2MudXBkYXRlZEF0fVxuICAgICAgICAgICAgaW5pdGlhbENyb3A9e3VwbG9hZEVkaXRzPy5jcm9wID8/IHVuZGVmaW5lZH1cbiAgICAgICAgICAgIGluaXRpYWxGb2NhbFBvaW50PXt7XG4gICAgICAgICAgICAgIHg6IHVwbG9hZEVkaXRzPy5mb2NhbFBvaW50Py54IHx8IGRvYy5mb2NhbFggfHwgNTAsXG4gICAgICAgICAgICAgIHk6IHVwbG9hZEVkaXRzPy5mb2NhbFBvaW50Py55IHx8IGRvYy5mb2NhbFkgfHwgNTAsXG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgb25TYXZlPXtvbkVkaXRzU2F2ZX1cbiAgICAgICAgICAgIHNob3dDcm9wPXtzaG93Q3JvcH1cbiAgICAgICAgICAgIHNob3dGb2NhbFBvaW50PXtzaG93Rm9jYWxQb2ludH1cbiAgICAgICAgICAvPlxuICAgICAgICA8L0RyYXdlcj5cbiAgICAgICl9XG4gICAgICB7ZG9jICYmIGhhc0ltYWdlU2l6ZXMgJiYgKFxuICAgICAgICA8RHJhd2VyXG4gICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19wcmV2aWV3RHJhd2VyYH1cbiAgICAgICAgICBob3ZlclRpdGxlXG4gICAgICAgICAgc2x1Zz17c2l6ZVByZXZpZXdTbHVnfVxuICAgICAgICAgIHRpdGxlPXt0KCd1cGxvYWQ6c2l6ZXNGb3InLCB7IGxhYmVsOiBkb2M/LmZpbGVuYW1lIH0pfVxuICAgICAgICA+XG4gICAgICAgICAgPFByZXZpZXdTaXplcyBjb2xsZWN0aW9uPXtjb2xsZWN0aW9ufSBkb2M9e2RvY30gaW1hZ2VDYWNoZVRhZz17ZG9jLnVwZGF0ZWRBdH0gLz5cbiAgICAgICAgPC9EcmF3ZXI+XG4gICAgICApfVxuICAgIDwvZGl2PlxuICApXG59XG4iXSwibmFtZXMiOlsiVXBsb2FkIiwiVXBsb2FkQWN0aW9ucyIsImVkaXREcmF3ZXJTbHVnIiwic2l6ZVByZXZpZXdTbHVnIiwiYmFzZUNsYXNzIiwidmFsaWRhdGUiLCJ2YWx1ZSIsInVuZGVmaW5lZCIsImNhbkVkaXQiLCJzaG93U2l6ZVByZXZpZXdzIiwidCIsInVzZVRyYW5zbGF0aW9uIiwiZGl2IiwiY2xhc3NOYW1lIiwiRHJhd2VyVG9nZ2xlciIsInNsdWciLCJwcm9wcyIsImNvbGxlY3Rpb24iLCJpbnRlcm5hbFN0YXRlIiwib25DaGFuZ2UiLCJyZXBsYWNpbmdGaWxlIiwic2V0UmVwbGFjaW5nRmlsZSIsInVzZVN0YXRlIiwiZmlsZVNyYyIsInNldEZpbGVTcmMiLCJzZXRNb2RpZmllZCIsInVzZUZvcm0iLCJyZXNldFVwbG9hZEVkaXRzIiwidXBkYXRlVXBsb2FkRWRpdHMiLCJ1cGxvYWRFZGl0cyIsInVzZVVwbG9hZEVkaXRzIiwiZG9jIiwic2V0RG9jIiwicmVkdWNlRmllbGRzVG9WYWx1ZXMiLCJkb2NQZXJtaXNzaW9ucyIsInVzZURvY3VtZW50SW5mbyIsImVycm9yTWVzc2FnZSIsInNldFZhbHVlIiwic2hvd0Vycm9yIiwidXNlRmllbGQiLCJwYXRoIiwic2hvd1VybElucHV0Iiwic2V0U2hvd1VybElucHV0IiwiZmlsZVVybCIsInNldEZpbGVVcmwiLCJjdXJzb3JQb3NpdGlvblJlZiIsInVzZVJlZiIsInVybElucHV0UmVmIiwiaGFuZGxlRmlsZUNoYW5nZSIsInVzZUNhbGxiYWNrIiwibmV3RmlsZSIsIkZpbGUiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImUiLCJpbWdTcmMiLCJ0YXJnZXQiLCJyZXN1bHQiLCJyZWFkQXNEYXRhVVJMIiwiaGFuZGxlRmlsZU5hbWVDaGFuZ2UiLCJ1cGRhdGVkRmlsZU5hbWUiLCJjdXJzb3JQb3NpdGlvbiIsInNlbGVjdGlvblN0YXJ0IiwiY3VycmVudCIsImZpbGVWYWx1ZSIsInR5cGUiLCJ1c2VFZmZlY3QiLCJpbnB1dEVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImhhbmRsZUZpbGVTZWxlY3Rpb24iLCJSZWFjdCIsImZpbGVzIiwiZmlsZVRvVXBsb2FkIiwiaGFuZGxlRmlsZVJlbW92YWwiLCJvbkVkaXRzU2F2ZSIsImFyZ3MiLCJoYW5kbGVQYXN0ZVVybENsaWNrIiwicHJldiIsImhhbmRsZVVybFN1Ym1pdCIsInJlc3BvbnNlIiwiZmV0Y2giLCJkYXRhIiwiYmxvYiIsImZpbGVOYW1lIiwic3BsaXQiLCJwb3AiLCJmaWxlIiwidG9hc3QiLCJlcnJvciIsIm1lc3NhZ2UiLCJmb2N1cyIsImNhblJlbW92ZVVwbG9hZCIsInVwZGF0ZSIsInBlcm1pc3Npb24iLCJkZWxldGUiLCJoYXNJbWFnZVNpemVzIiwidXBsb2FkIiwiaW1hZ2VTaXplcyIsImxlbmd0aCIsImhhc1Jlc2l6ZU9wdGlvbnMiLCJCb29sZWFuIiwicmVzaXplT3B0aW9ucyIsImZvY2FsUG9pbnRFbmFibGVkIiwiZm9jYWxQb2ludCIsImNyb3AiLCJzaG93Q3JvcCIsInNob3dGb2NhbFBvaW50IiwiZmllbGRCYXNlQ2xhc3MiLCJmaWx0ZXIiLCJqb2luIiwiRXJyb3IiLCJmaWxlbmFtZSIsIkZpbGVEZXRhaWxzIiwiaGFuZGxlUmVtb3ZlIiwiaW1hZ2VDYWNoZVRhZyIsInVwZGF0ZWRBdCIsIkRyb3B6b25lIiwibWltZVR5cGVzIiwib25QYXN0ZVVybENsaWNrIiwiRnJhZ21lbnQiLCJpbnB1dCIsInJlZiIsImJ1dHRvbiIsIm9uQ2xpY2siLCJCdXR0b24iLCJidXR0b25TdHlsZSIsImljb24iLCJpY29uU3R5bGUiLCJyb3VuZCIsInRvb2x0aXAiLCJUaHVtYm5haWwiLCJpc0ltYWdlIiwibmFtZSIsIkRyYXdlciIsImhlYWRlciIsIkVkaXRVcGxvYWQiLCJ1cmwiLCJpbml0aWFsQ3JvcCIsImluaXRpYWxGb2NhbFBvaW50IiwieCIsImZvY2FsWCIsInkiLCJmb2NhbFkiLCJvblNhdmUiLCJob3ZlclRpdGxlIiwidGl0bGUiLCJsYWJlbCIsIlByZXZpZXdTaXplcyJdLCJyYW5nZU1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQXNEYUEsTUFBTTtlQUFOQTs7SUFsQkFDLGFBQWE7ZUFBYkE7O0lBWEFDLGNBQWM7ZUFBZEE7O0lBQ0FDLGVBQWU7ZUFBZkE7OzsrREExQm1EOzhCQUNqQzsrQkFDVDtnRUFLRjsrREFDRDt3QkFDbUI7MEJBQ2I7NEJBQ0U7b0VBQ0g7cUVBQ0M7a0VBQ0g7OERBQ0o7eUJBQ007NkVBQ1M7d0JBQ0Y7aUVBQ1Y7OEJBQ1c7NkJBQ0Q7UUFDeEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRVAsTUFBTUMsWUFBWTtBQUNYLE1BQU1GLGlCQUFpQjtBQUN2QixNQUFNQyxrQkFBa0I7QUFFL0IsTUFBTUUsV0FBVyxDQUFDQztJQUNoQixJQUFJLENBQUNBLFNBQVNBLFVBQVVDLFdBQVc7UUFDakMsT0FBTztJQUNUO0lBRUEsT0FBTztBQUNUO0FBRU8sTUFBTU4sZ0JBQWdCLENBQUMsRUFBRU8sT0FBTyxFQUFFQyxnQkFBZ0IsRUFBRTtJQUN6RCxNQUFNLEVBQUVDLENBQUMsRUFBRSxHQUFHQyxJQUFBQSw0QkFBYyxFQUFDO0lBQzdCLHFCQUNFLDZCQUFDQztRQUFJQyxXQUFXLENBQUMsRUFBRVQsVUFBVSxlQUFlLENBQUM7T0FDMUNLLGtDQUNDLDZCQUFDSyxxQkFBYTtRQUFDRCxXQUFXLENBQUMsRUFBRVQsVUFBVSxjQUFjLENBQUM7UUFBRVcsTUFBTVo7T0FDM0RPLEVBQUUseUJBR05GLHlCQUNDLDZCQUFDTSxxQkFBYTtRQUFDRCxXQUFXLENBQUMsRUFBRVQsVUFBVSxNQUFNLENBQUM7UUFBRVcsTUFBTWI7T0FDbkRRLEVBQUU7QUFLYjtBQUVPLE1BQU1WLFNBQTBCLENBQUNnQjtJQUN0QyxNQUFNLEVBQUVDLFVBQVUsRUFBRUMsYUFBYSxFQUFFQyxRQUFRLEVBQUUsR0FBR0g7SUFDaEQsTUFBTSxDQUFDSSxlQUFlQyxpQkFBaUIsR0FBR0MsSUFBQUEsZUFBUSxFQUFDO0lBQ25ELE1BQU0sQ0FBQ0MsU0FBU0MsV0FBVyxHQUFHRixJQUFBQSxlQUFRLEVBQWdCO0lBQ3RELE1BQU0sRUFBRVosQ0FBQyxFQUFFLEdBQUdDLElBQUFBLDRCQUFjLEVBQUM7UUFBQztRQUFVO0tBQVU7SUFDbEQsTUFBTSxFQUFFYyxXQUFXLEVBQUUsR0FBR0MsSUFBQUEsZ0JBQU87SUFDL0IsTUFBTSxFQUFFQyxnQkFBZ0IsRUFBRUMsaUJBQWlCLEVBQUVDLFdBQVcsRUFBRSxHQUFHQyxJQUFBQSwyQkFBYztJQUMzRSxNQUFNLENBQUNDLEtBQUtDLE9BQU8sR0FBR1YsSUFBQUEsZUFBUSxFQUFDVyxJQUFBQSw2QkFBb0IsRUFBQ2YsaUJBQWlCLENBQUMsR0FBRztJQUN6RSxNQUFNLEVBQUVnQixjQUFjLEVBQUUsR0FBR0MsSUFBQUEsNkJBQWU7SUFDMUMsTUFBTSxFQUFFQyxZQUFZLEVBQUVDLFFBQVEsRUFBRUMsU0FBUyxFQUFFaEMsS0FBSyxFQUFFLEdBQUdpQyxJQUFBQSxpQkFBUSxFQUFPO1FBQ2xFQyxNQUFNO1FBQ05uQztJQUNGO0lBRUEsTUFBTSxDQUFDb0MsY0FBY0MsZ0JBQWdCLEdBQUdwQixJQUFBQSxlQUFRLEVBQUM7SUFDakQsTUFBTSxDQUFDcUIsU0FBU0MsV0FBVyxHQUFHdEIsSUFBQUEsZUFBUSxFQUFTO0lBRS9DLE1BQU11QixvQkFBb0JDLElBQUFBLGFBQU0sRUFBQztJQUNqQyxNQUFNQyxjQUFjRCxJQUFBQSxhQUFNLEVBQW1CO0lBRTdDLE1BQU1FLG1CQUFtQkMsSUFBQUEsa0JBQVcsRUFDbEMsQ0FBQ0M7UUFDQyxJQUFJQSxtQkFBbUJDLE1BQU07WUFDM0IsTUFBTUMsYUFBYSxJQUFJQztZQUN2QkQsV0FBV0UsTUFBTSxHQUFHLENBQUNDO2dCQUNuQixNQUFNQyxTQUFTRCxFQUFFRSxNQUFNLEVBQUVDO2dCQUV6QixJQUFJLE9BQU9GLFdBQVcsVUFBVTtvQkFDOUJoQyxXQUFXZ0M7Z0JBQ2I7WUFDRjtZQUNBSixXQUFXTyxhQUFhLENBQUNUO1FBQzNCO1FBRUFiLFNBQVNhO1FBQ1RSLGdCQUFnQjtRQUVoQixJQUFJLE9BQU92QixhQUFhLFlBQVk7WUFDbENBLFNBQVMrQjtRQUNYO0lBQ0YsR0FDQTtRQUFDL0I7UUFBVWtCO0tBQVM7SUFHdEIsTUFBTXVCLHVCQUF1QixDQUFDTDtRQUM1QixNQUFNTSxrQkFBa0JOLEVBQUVFLE1BQU0sQ0FBQ25ELEtBQUs7UUFDdEMsTUFBTXdELGlCQUFpQlAsRUFBRUUsTUFBTSxDQUFDTSxjQUFjO1FBRTlDbEIsa0JBQWtCbUIsT0FBTyxHQUFHRjtRQUU1QixJQUFJeEQsT0FBTztZQUNULE1BQU0yRCxZQUFZM0Q7WUFDbEIscURBQXFEO1lBQ3JELE1BQU00QyxVQUFVLElBQUlDLEtBQUs7Z0JBQUNjO2FBQVUsRUFBRUosaUJBQWlCO2dCQUFFSyxNQUFNRCxVQUFVQyxJQUFJO1lBQUM7WUFDOUVsQixpQkFBaUJFO1FBQ25CO0lBQ0Y7SUFFQWlCLElBQUFBLGdCQUFTLEVBQUM7UUFDUiw0RUFBNEU7UUFDNUUsTUFBTUMsZUFBZUMsU0FBU0MsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFbEUsVUFBVSxVQUFVLENBQUM7UUFDckUsSUFBSWdFLGdCQUFnQnZCLGtCQUFrQm1CLE9BQU8sS0FBSyxNQUFNO1lBQ3RESSxhQUFhRyxpQkFBaUIsQ0FBQzFCLGtCQUFrQm1CLE9BQU8sRUFBRW5CLGtCQUFrQm1CLE9BQU87UUFDckY7SUFDRixHQUFHO1FBQUMxRDtLQUFNO0lBRVYsTUFBTWtFLHNCQUFzQkMsY0FBSyxDQUFDeEIsV0FBVyxDQUMzQyxDQUFDeUI7UUFDQyxNQUFNQyxlQUFlRCxPQUFPLENBQUMsRUFBRTtRQUMvQjFCLGlCQUFpQjJCO0lBQ25CLEdBQ0E7UUFBQzNCO0tBQWlCO0lBR3BCLE1BQU00QixvQkFBb0IzQixJQUFBQSxrQkFBVyxFQUFDO1FBQ3BDNUIsaUJBQWlCO1FBQ2pCMkIsaUJBQWlCO1FBQ2pCeEIsV0FBVztRQUNYb0IsV0FBVztRQUNYWixPQUFPLENBQUM7UUFDUkw7UUFDQWUsZ0JBQWdCO0lBQ2xCLEdBQUc7UUFBQ007UUFBa0JyQjtLQUFpQjtJQUV2QyxNQUFNa0QsY0FBYzVCLElBQUFBLGtCQUFXLEVBQzdCLENBQUM2QjtRQUNDckQsWUFBWTtRQUNaRyxrQkFBa0JrRDtJQUNwQixHQUNBO1FBQUNyRDtRQUFhRztLQUFrQjtJQUdsQyxNQUFNbUQsc0JBQXNCO1FBQzFCckMsZ0JBQWdCLENBQUNzQyxPQUFTLENBQUNBO0lBQzdCO0lBRUEsTUFBTUMsa0JBQWtCO1FBQ3RCLElBQUl0QyxTQUFTO1lBQ1gsSUFBSTtnQkFDRixNQUFNdUMsV0FBVyxNQUFNQyxNQUFNeEM7Z0JBQzdCLE1BQU15QyxPQUFPLE1BQU1GLFNBQVNHLElBQUk7Z0JBRWhDLHFDQUFxQztnQkFDckMsTUFBTUMsV0FBVzNDLFFBQVE0QyxLQUFLLENBQUMsS0FBS0MsR0FBRztnQkFFdkMsOENBQThDO2dCQUM5QyxNQUFNQyxPQUFPLElBQUl0QyxLQUFLO29CQUFDaUM7aUJBQUssRUFBRUUsVUFBVTtvQkFBRXBCLE1BQU1rQixLQUFLbEIsSUFBSTtnQkFBQztnQkFDMURsQixpQkFBaUJ5QztZQUNuQixFQUFFLE9BQU9sQyxHQUFHO2dCQUNWbUMsb0JBQUssQ0FBQ0MsS0FBSyxDQUFDcEMsRUFBRXFDLE9BQU87WUFDdkI7UUFDRjtJQUNGO0lBRUF6QixJQUFBQSxnQkFBUyxFQUFDO1FBQ1JuQyxPQUFPQyxJQUFBQSw2QkFBb0IsRUFBQ2YsaUJBQWlCLENBQUMsR0FBRztRQUNqREcsaUJBQWlCO0lBQ25CLEdBQUc7UUFBQ0g7S0FBYztJQUVsQmlELElBQUFBLGdCQUFTLEVBQUM7UUFDUixJQUFJMUIsZ0JBQWdCTSxZQUFZaUIsT0FBTyxFQUFFO1lBQ3ZDakIsWUFBWWlCLE9BQU8sQ0FBQzZCLEtBQUssR0FBRyxnRUFBZ0U7O1FBQzlGO0lBQ0YsR0FBRztRQUFDcEQ7S0FBYTtJQUVqQixNQUFNcUQsa0JBQ0o1RCxnQkFBZ0I2RCxRQUFRQyxjQUN4QixZQUFZOUQsa0JBQ1pBLGdCQUFnQitELFFBQVFEO0lBRTFCLE1BQU1FLGdCQUFnQmpGLFlBQVlrRixRQUFRQyxZQUFZQyxTQUFTO0lBQy9ELE1BQU1DLG1CQUFtQkMsUUFBUXRGLFlBQVlrRixRQUFRSztJQUNyRCx3REFBd0Q7SUFDeEQsTUFBTUMsb0JBQW9CeEYsWUFBWWtGLFFBQVFPLGVBQWU7SUFFN0QsTUFBTSxFQUFFekYsWUFBWSxFQUFFa0YsUUFBUSxFQUFFUSxNQUFNQyxXQUFXLElBQUksRUFBRUYsYUFBYSxJQUFJLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcxRjtJQUV0RixNQUFNNkYsaUJBQWlCSCxjQUFlUixDQUFBQSxpQkFBaUJJLG9CQUFvQkcsaUJBQWdCO0lBRTNGLHFCQUNFLDZCQUFDN0Y7UUFBSUMsV0FBVztZQUFDaUcsc0JBQWM7WUFBRTFHO1NBQVUsQ0FBQzJHLE1BQU0sQ0FBQ1IsU0FBU1MsSUFBSSxDQUFDO3FCQUMvRCw2QkFBQ0MsY0FBSztRQUFDckIsU0FBU3hEO1FBQWNFLFdBQVdBO1FBRXhDUCxJQUFJbUYsUUFBUSxJQUFJLENBQUM5RiwrQkFDaEIsNkJBQUMrRixvQkFBVztRQUNWM0csU0FBU29HLFlBQVlDO1FBQ3JCNUYsWUFBWUE7UUFDWmMsS0FBS0E7UUFDTHFGLGNBQWN0QixrQkFBa0JsQixvQkFBb0JyRTtRQUNwRDJGLGVBQWVBO1FBQ2ZtQixlQUFldEYsSUFBSXVGLFNBQVM7UUFHL0IsQUFBQyxDQUFBLENBQUN2RixJQUFJbUYsUUFBUSxJQUFJOUYsYUFBWSxtQkFDN0IsNkJBQUNSO1FBQUlDLFdBQVcsQ0FBQyxFQUFFVCxVQUFVLFFBQVEsQ0FBQztPQUNuQyxDQUFDRSxTQUFTLENBQUNtQyw4QkFDViw2QkFBQzhFLGtCQUFRO1FBQ1AxRyxXQUFXLENBQUMsRUFBRVQsVUFBVSxVQUFVLENBQUM7UUFDbkNvSCxXQUFXdkcsWUFBWWtGLFFBQVFxQjtRQUMvQnJHLFVBQVVxRDtRQUNWaUQsaUJBQWlCMUM7UUFHcEJ0Qyw4QkFDQyw2QkFBQ2dDLGNBQUssQ0FBQ2lELFFBQVEsc0JBQ2IsNkJBQUM5RztRQUFJQyxXQUFXLENBQUMsRUFBRVQsVUFBVSxrQkFBa0IsQ0FBQztxQkFDOUMsNkJBQUN1SDtRQUNDOUcsV0FBVyxDQUFDLEVBQUVULFVBQVUsYUFBYSxDQUFDO1FBQ3RDZSxVQUFVLENBQUNvQztZQUNUWCxXQUFXVyxFQUFFRSxNQUFNLENBQUNuRCxLQUFLO1FBQzNCO1FBQ0FzSCxLQUFLN0U7UUFDTG1CLE1BQUs7UUFDTDVELE9BQU9xQztzQkFFVCw2QkFBQy9CO1FBQUlDLFdBQVcsQ0FBQyxFQUFFVCxVQUFVLGVBQWUsQ0FBQztxQkFDM0MsNkJBQUN5SDtRQUNDaEgsV0FBVyxDQUFDLEVBQUVULFVBQVUsVUFBVSxDQUFDO1FBQ25DMEgsU0FBUzdDO1FBQ1RmLE1BQUs7T0FFSnhELEVBQUUsb0NBSVQsNkJBQUNxSCxlQUFNO1FBQ0xDLGFBQVk7UUFDWm5ILFdBQVcsQ0FBQyxFQUFFVCxVQUFVLFFBQVEsQ0FBQztRQUNqQzZILE1BQUs7UUFDTEMsV0FBVTtRQUNWSixTQUFTbEQ7UUFDVHVELE9BQUFBO1FBQ0FDLFNBQVMxSCxFQUFFO1NBSWhCSix1QkFDQyw2QkFBQ21FLGNBQUssQ0FBQ2lELFFBQVEsc0JBQ2IsNkJBQUM5RztRQUFJQyxXQUFXLENBQUMsRUFBRVQsVUFBVSxnQkFBZ0IsQ0FBQztxQkFDNUMsNkJBQUNpSSxrQkFBUztRQUFDOUcsU0FBUytHLElBQUFBLGdCQUFPLEVBQUNoSSxNQUFNNEQsSUFBSSxJQUFJM0MsVUFBVTt1QkFFdEQsNkJBQUNYO1FBQUlDLFdBQVcsQ0FBQyxFQUFFVCxVQUFVLGtCQUFrQixDQUFDO3FCQUM5Qyw2QkFBQ3VIO1FBQ0M5RyxXQUFXLENBQUMsRUFBRVQsVUFBVSxVQUFVLENBQUM7UUFDbkNlLFVBQVV5QztRQUNWTSxNQUFLO1FBQ0w1RCxPQUFPQSxNQUFNaUksSUFBSTtRQUdsQkQsSUFBQUEsZ0JBQU8sRUFBQ2hJLE1BQU00RCxJQUFJLEtBQUs1RCxNQUFNNEQsSUFBSSxLQUFLLGlDQUNyQyw2QkFBQ2pFO1FBQ0NPLFNBQVNvRyxZQUFZQztRQUNyQnBHLGtCQUFrQnlGLGlCQUFpQm5FLElBQUltRixRQUFRLElBQUksQ0FBQzlGO3VCQUkxRCw2QkFBQzJHLGVBQU07UUFDTEMsYUFBWTtRQUNabkgsV0FBVyxDQUFDLEVBQUVULFVBQVUsUUFBUSxDQUFDO1FBQ2pDNkgsTUFBSztRQUNMQyxXQUFVO1FBQ1ZKLFNBQVNsRDtRQUNUdUQsT0FBQUE7UUFDQUMsU0FBUzFILEVBQUU7VUFPcEIsQUFBQ0osQ0FBQUEsU0FBU3lCLElBQUltRixRQUFRLEFBQUQsbUJBQ3BCLDZCQUFDc0IsY0FBTTtRQUFDQyxRQUFRO1FBQU0xSCxNQUFNYjtxQkFDMUIsNkJBQUN3SSxzQkFBVTtRQUNUcEQsVUFBVWhGLE9BQU9pSSxRQUFReEcsS0FBS21GO1FBQzlCM0YsU0FBU1EsS0FBSzRHLE9BQU9wSDtRQUNyQjhGLGVBQWV0RixJQUFJdUYsU0FBUztRQUM1QnNCLGFBQWEvRyxhQUFhOEUsUUFBUXBHO1FBQ2xDc0ksbUJBQW1CO1lBQ2pCQyxHQUFHakgsYUFBYTZFLFlBQVlvQyxLQUFLL0csSUFBSWdILE1BQU0sSUFBSTtZQUMvQ0MsR0FBR25ILGFBQWE2RSxZQUFZc0MsS0FBS2pILElBQUlrSCxNQUFNLElBQUk7UUFDakQ7UUFDQUMsUUFBUXJFO1FBQ1IrQixVQUFVQTtRQUNWQyxnQkFBZ0JBO1NBSXJCOUUsT0FBT21FLCtCQUNOLDZCQUFDc0MsY0FBTTtRQUNMM0gsV0FBVyxDQUFDLEVBQUVULFVBQVUsZUFBZSxDQUFDO1FBQ3hDK0ksWUFBQUE7UUFDQXBJLE1BQU1aO1FBQ05pSixPQUFPMUksRUFBRSxtQkFBbUI7WUFBRTJJLE9BQU90SCxLQUFLbUY7UUFBUztxQkFFbkQsNkJBQUNvQyxxQkFBWTtRQUFDckksWUFBWUE7UUFBWWMsS0FBS0E7UUFBS3NGLGVBQWV0RixJQUFJdUYsU0FBUzs7QUFLdEYifQ==